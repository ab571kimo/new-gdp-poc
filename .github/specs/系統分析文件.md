# 系統分析文件 GDP POC 系統

版本：001

## 1. 更新紀錄

| 日期       | API編號      | 說明                                           |
| ---------- | ------------ | ---------------------------------------------- |
| 2025-12-12 | GDP_API_0001 | 依據需求規格書[001]進行建立，新增取得站台選單結構資料 API |

## 2. API 設計

### 2.1 API 列表

- GDP_API_0001 - GET /api/menu/structure

### 2.2 API 參數說明

#### GDP_API_0001 - GET /api/menu/structure

取得站台選單結構資料，回傳雙層式選單（選單群組 > 頁面）的完整結構。

**Request:**

| 位置 | 參數 | 類型 | 必填 | 說明 |
|---|---:|---:|---:|--- |
| - | - | - | - | 無請求參數 |

**Response 200:**

| 欄位 | 類型 | 說明 |
|---|---:|--- |
| menuGroups | Array | 選單群組列表 |
| menuGroups[].menuId | String | 選單識別碼 |
| menuGroups[].menuName | String | 選單名稱 |
| menuGroups[].menuNo | Number | 選單排序編號（數字越小越前面） |
| menuGroups[].pages | Array | 該選單群組下的頁面列表 |
| menuGroups[].pages[].pageId | String | 頁面識別碼 |
| menuGroups[].pages[].pageName | String | 頁面名稱 |
| menuGroups[].pages[].pageNo | Number | 頁面排序編號（數字越小越前面） |
| menuGroups[].pages[].iframeId | String | 內嵌頁面識別碼（選填，用於內嵌模式） |
| menuGroups[].pages[].pageUrl | String | 頁面網址（選填，用於 URL 導頁模式） |

**Response 範例:**

```json
{
  "menuGroups": [
    {
      "menuId": "menu001",
      "menuName": "功能選單 A",
      "menuNo": 1,
      "pages": [
        {
          "pageId": "page001",
          "pageName": "內嵌頁面 A1",
          "pageNo": 1,
          "iframeId": "iframe_a1"
        },
        {
          "pageId": "page002",
          "pageName": "URL導頁 A2",
          "pageNo": 2,
          "pageUrl": "https://example.com/page-a2"
        },
        {
          "pageId": "page003",
          "pageName": "內嵌頁面 A3",
          "pageNo": 3,
          "iframeId": "iframe_a3"
        }
      ]
    },
    {
      "menuId": "menu002",
      "menuName": "功能選單 B",
      "menuNo": 2,
      "pages": [
        {
          "pageId": "page004",
          "pageName": "內嵌頁面 B1",
          "pageNo": 1,
          "iframeId": "iframe_b1"
        },
        {
          "pageId": "page005",
          "pageName": "URL導頁 B2",
          "pageNo": 2,
          "pageUrl": "https://example.com/page-b2"
        }
      ]
    }
  ]
}
```

**Response 400:**

| 欄位 | 類型 | 說明 |
|---|---:|--- |
| error | String | 錯誤訊息 |
| errorCode | String | 錯誤代碼 |

**Response 500:**

| 欄位 | 類型 | 說明 |
|---|---:|--- |
| error | String | 錯誤訊息 |
| errorCode | String | 錯誤代碼 |

**資料來源表:** dev_temp.data_engineer.gdp_menu_data, dev_temp.data_engineer.gdp_page_data

**業務邏輯說明:**

此 API 不需要請求參數，直接回傳系統設定的選單結構資料。

查詢邏輯：
1. 查詢 gdp_menu_data 表取得所有選單群組，依 menu_no 欄位升冪排序
2. 依每個選單的 menu_id 查詢 gdp_page_data 表取得該選單群組下的所有頁面，依 page_no 欄位升冪排序
3. 組合選單群組與頁面資料，回傳完整的雙層結構
4. 若查詢結果為空，回傳空陣列 `{"menuGroups": []}`

排序邏輯：
- 選單群組按 menu_no 數字由小到大排序（例如：menu_no=1 排在 menu_no=2 前面）
- 每個選單群組內的頁面按 page_no 數字由小到大排序（例如：page_no=1 排在 page_no=2 前面）

頁面顯示模式判斷：
- 若 gdp_page_data 中的 dashboard_id 欄位有值，該頁面為內嵌模式
- 若 gdp_page_data 中的 url 欄位有值（且 dashboard_id 為空），該頁面為 URL 導頁模式
- 若兩者皆有值，優先使用 dashboard_id（內嵌模式）
- 若兩者皆無值，仍回傳該頁面資料，由前端判斷該頁面不可點選

**SQL 查詢語句:**

```sql
-- 查詢選單群組資料
SELECT menu_id, menu_name, menu_no
FROM dev_temp.data_engineer.gdp_menu_data
ORDER BY menu_no ASC;

-- 查詢指定選單下的頁面資料
SELECT page_id, page_name, page_no, dashboard_id, url
FROM dev_temp.data_engineer.gdp_page_data
WHERE menu_id = :menu_id
ORDER BY page_no ASC;
```
